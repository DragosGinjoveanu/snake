<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css">

    <script src = "script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <title>Snake</title>
  </head>
  <body>

    <div class="container">
      <div class="card">
        <div class="card-header">
          <button type="button" class="btn btn-success" onclick="loadSnake();">Play<i class="las la-hand-point-up"></i></button>
          <button type="button" class="btn btn-danger" onclick="restartGame();"><i class="las la-redo-alt"></i></button>
          <h3 id = "status"></h3>
          <h3 id = "score">Score:</h3>
        </div>
        <div class="card-body mx-auto">
            <table id="table">
              
            </table>
        </div>
    </div>
    <script type="text/javascript">
      
      //declar tabela, 0 deocamdata peste tot.
      var table = [];
      for (var i = 1; i <= 15; i++) {
          table[i] = [];
          for (var j = 1; j <= 15; j++) {
              table[i][j] = 0;
          }
      }

      var score = 0;
      var snakeRow = [];
      var snakeColumn = [];

      function generateFood() {
        var i = Math.floor(Math.random() * (15) + 1);
        var j = Math.floor(Math.random() * (15) + 1);
        var ok = 1;
        for (var a = 0; a < snakeRow.length; a++) {
          if (snakeRow[a] == i && snakeColumn[a] == j) {
            ok = 0;
          }
        }
        if (ok == 1) {
          table[i][j] = 2;
          var id = i + String(j);
          document.getElementById(id).innerHTML = ('󠀠󠀠<i class="las la-apple-alt"></i>');
          document.getElementById(id).className = "btn btn-danger btn-lg"; 
        } else {
          generateFood();
        }
      }

      //generates snake + initial snake position
      function loadSnake() {
        for (var i = 1; i <= 15; i++) {
          $('#table').append(`
            <tr></tr>
          `)
          for (var j = 1; j <= 15; j++) {
            $('#table').append(`
              <td><button type="button" class="btn btn-secondary btn-lg" id = "` + i + + j +`"><i class="las la-stop"></i></button></td>
            `);
            // sarpele initial
            if ((i == 1 && j == 1) || (i == 1 && j == 2) || (i == 1 && j == 3)) {
              var id = i + String(j);
              lengthenSnake(id);
              snakeRow.push(i);
              snakeColumn.push(j);
              table[i][j] = 1;
            }
          }
        }
        generateFood();
      }

      document.addEventListener('keyup', (event) => {
          var headRow = snakeRow[snakeRow.length - 1];
          var headColumn = snakeColumn[snakeColumn.length - 1];
          //works
          if (event.key == 'ArrowUp') {
            if (headRow - 1 >= 1 && table[headRow - 1][headColumn] != 1) {
              updateSnake(headRow - 1, headColumn);
            } else {
              lostGame();
            }
          } else if (event.key == 'ArrowDown') {
            if (headRow + 1 <= 15 && table[headRow + 1][headColumn] != 1) {
              updateSnake(headRow + 1, headColumn);
            } else {
              lostGame();
            }
          } else if (event.key == 'ArrowLeft') {
            if (headColumn - 1 >= 1 && table[headRow][headColumn - 1] != 1) {
              updateSnake(headRow, headColumn - 1);
            } else {
              lostGame();
            }
          } else if (event.key == 'ArrowRight') {
            if (headColumn + 1 <= 15 && table[headRow][headColumn + 1] != 1) {
              updateSnake(headRow, headColumn + 1);
            } else {
              lostGame();
            }
          }
      });

      function updateSnake(row, column) {
        if (table[row][column] == 0) {
          //stergem primul element;
          table[snakeRow[0]][snakeColumn[0]] = 0;
          var firstId = snakeRow[0] + String(snakeColumn[0]);
          document.getElementById(firstId).innerHTML = ('󠀠󠀠<i class="las la-stop"></i>');
          document.getElementById(firstId).className = "btn btn-secondary btn-lg"; 
          snakeRow.shift();
          snakeColumn.shift();
          //adaugam ultimul element
          snakeRow.push(row);
          snakeColumn.push(column);
          table[row][column] = 1;
          var secondId = row + String(column);
          lengthenSnake(secondId);
        } else if (table[row][column] == 2) {
          snakeRow.push(row);
          snakeColumn.push(column);
          table[row][column] = 1;
          var id = row + String(column);
          lengthenSnake(id);
          score++;
          document.getElementById("score").innerHTML = "Score: " + score; 
          generateFood();
        }
        
      }

      function lengthenSnake(id) {
          document.getElementById(id).innerHTML = ('󠀠󠀠<i class="las la-horse-head"></i>');
          document.getElementById(id).className = "btn btn-success btn-lg"; 
      }

      function lostGame() {
          document.getElementById("status").innerHTML = "You lost! Please restart!";
          document.getElementById("status").style.color = "red";
      }

      function restartGame() {
        location.reload();
      }

    </script>
  </body>
</html>
